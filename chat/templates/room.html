{% extends 'base.html' %}
{% block content %}
    <div id="room-container">
        <h2 id="home-header">Flask Chat ðŸ’¬</h2>
        <div id="room-subsection">
            <h4 id="room-code-display">ÐšÐ¾Ð´ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹: <span>{{ room }}</span></h4>
            <a href="/" id="leave-chat-btn" class="btn btn-danger">Ð’Ñ‹Ð¹Ñ‚Ð¸ Ð¸Ð· Ñ‡Ð°Ñ‚Ð°</a>
        </div>
        <div id="chat-room-widget">
            <div id="msgs-container">
                <ul id="messages"></ul>
            </div>
            <div id="message-box">
                <input type="text" placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ" id="message-input" name="message"/>
                <button type="submit" id="send-btn" onclick="sendMessage()">ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ</button>
            </div>
        </div>
        <script type="text/javascript">
            var socketio = io();
            socketio.on("message", function (message) {
                createChatItem(message.message, message.sender)
            });

            function createChatItem(message, sender) {
                var messages = document.getElementById("messages");
                if (sender === "") {
                    content = `<p class="member-activity">${message}</p>`;
                } else {
                    var senderIsUser = "{{user}}" === sender;
                    var content = `
          <li class="message-item ${senderIsUser ? "self-message-item" : "peer-message-item"}">
              <p>${message}</p>
              <small class="${senderIsUser ? "muted-text" : "muted-text-white"}">${new Date().toLocaleString()}</small>
          </li>
      `;
                }
                messages.innerHTML += content;
            }

            function sendMessage() {
                var msgInput = document.getElementById("message-input");
                if (msgInput.value === "") return;
                var msg = msgInput.value;
                socketio.emit("message", {message: msg});
                msgInput.value = "";
            }
        </script>
        {% for message in messages %}
            <script type="text/javascript">
                createChatItem("{{message.message}}", "{{message.sender}}");
            </script>
        {% endfor %}
    </div>
{% endblock %}